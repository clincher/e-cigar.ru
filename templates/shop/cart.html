{% extends 'base.html' %}

{% block title %}Корзина в магазине e-cigar.ru{% endblock %}

{% block leftside %}
    <div class="margin-leftside">&nbsp;</div>
{% endblock %}
{% block rightside %}{% endblock %}

{% load i18n %}
{% block content %}
<h1>{% trans "Your shopping cart" %}</h1>
{% if cart_items %}
    {% if cart.total_price < 4000 %}
        <div class="notice">
            При сумме заказа более 4000 рублей Вас ждет приятный сюрприз - бесплатная доставка!!!
        </div>
    {% else %}
        <div class="notice">
            Ваш заказ больше 4000 рублей - Вас ждет бесплатная доставка!!!
        </div>
    {% endif %}
    <form method="post" action="{% url cart_update %}">
      {% csrf_token %}
      <table border="1">
        <thead>
          <tr>
          <th>{% trans "Product name" %}</th>
          <th>{% trans "Unit price" %}</th>
          <th>{% trans "Quantity" %}</th>
          <th>Суммарная стоимость</th>
          </tr>
        </thead>

        <tbody>
          {% for item in cart_items %}
            <tr>
              <td>{% if item.product.manufacturer %}{{item.product.manufacturer }} {% endif %}{{item.product.name}}</td>
              <td>{{item.product.get_price}} р</td>
              <td><input type="text" name="update_item-{{ item.id }}"
                value="{{ item.quantity }}"></td>
              <td>{{ item.line_subtotal }} р</td>
            </tr>
            {% if item.extra_price_fields.0.1 %}{# expression for show rebate if it exist #}
            {% for extra_price_field in item.extra_price_fields %}
              <tr>
                <td colspan="2">&nbsp;</td>
                <td>{{ extra_price_field.0 }}</td>
                <td>{{ extra_price_field.1 }}</td>
              </tr>
            {% endfor %}
            {% endif %}
{#            <tr><td colspan="2">&nbsp;</td><td>{% trans "Line Total" %}:</td><td>{{item.line_total}} р</td></tr>#}
          {% endfor %}
        </tbody>

        <tfoot>
{#          <tr><td colspan="2">&nbsp;</td><td>{% trans "Cart Subtotal" %}</td><td>{{cart.subtotal_price}} р</td></tr>#}
{#          {% for extra_price_field in cart.extra_price_fields %}#}
{#            <tr>#}
{#              <td colspan="2">&nbsp;</td>#}
{#              <td>{{ extra_price_field.0 }}</td>#}
{#              <td>{{ extra_price_field.1 }}</td>#}
{#            </tr>#}
{#          {% endfor %}#}
          <tr><td colspan="2">&nbsp;</td><td><b>Общая стоимость заказа</b></td><td><b>{{cart.total_price}} р</b></td></tr>
          <tr><td colspan="2">&nbsp;</td><td colspan="2"><input type="submit" value="Пересчитать корзину"/></td></tr>
          <tr><td colspan="2">&nbsp;</td><td colspan="2"><a class="checkout-link" href="{% url checkout_selection %}">Оформить заказ</a></td></tr>
        </tfoot>
      </table>
    </form>

    <form action="{% url cart_delete %}" method="post">
      {% csrf_token %}
      <p><input type="submit" value="Очистить корзину"/></p>
    </form>

{% else %}
<p>
  {% trans "Shopping cart is empty" %}
</p>
{% endif %}
{% endblock %}